# Backtesting & High-Fidelity Simulation

Dalam teori, arbitrase adalah keuntungan tanpa risiko. Dalam praktik, arbitrase adalah **balapan infrastruktur**. Masalah terbesar dalam backtesting arbitrase bukan pada logika strateginya, melainkan pada asumsi bahwa harga yang Anda lihat di layar adalah harga yang bisa Anda dapatkan (*fill price*).

Dokumen ini menjelaskan mengapa Anda memerlukan simulasi **High-Fidelity** untuk menghindari "kebangkrutan lewat backtest yang terlihat sempurna."

## Mengapa Backtest Arbitrase Tradisional Sering Gagal?

Kebanyakan platform backtesting menggunakan data *OHLC* (Open, High, Low, Close). Untuk arbitrase, data ini hampir tidak berguna karena:

1.  **Missing Micro-Spikes:** Peluang arbitrase sering muncul dan hilang dalam hitungan detik (bahkan milidetik). Data menit atau jam akan melewatkan ini.

2.  **The "Last Price" Fallacy:** Menggunakan harga transaksi terakhir (*Last Price*) sebagai acuan adalah kesalahan fatal. Anda harus menggunakan harga *Top of Book* (Bid/Ask) atau bahkan kedalaman *Order Book*.

3.  **Ignoring Fees:** Dalam arbitrase, margin sangat tipis (misal 0.1%). Biaya *Taker Fee* di kedua sisi bisa langsung menghapus seluruh keuntungan.

## Komponen High-Fidelity dalam Arbitrase

Untuk membuat simulasi yang jujur, kita harus memasukkan faktor-faktor berikut ke dalam mesin backtest:

### Latency (Latensi)

Waktu yang dibutuhkan bot untuk:

-   Menerima data dari Bursa A & B.

-   Menghitung peluang.

-   Mengirim perintah ke bursa.

-   **Dampak:** Saat perintah Anda sampai, harga mungkin sudah berubah (*Price Staling*).

### Slippage & Order Book Depth

Jika Anda ingin melakukan arbitrase sebesar \$10,000 tetapi hanya ada likuiditas sebesar \$2,000 di harga terbaik, sisa \$8,000 Anda akan dieksekusi di harga yang lebih buruk. Inilah yang disebut *Slippage*.

### The "Broken Leg" Risk

Risiko di mana satu sisi transaksi berhasil dieksekusi (*Filled*), tetapi sisi lainnya gagal karena harga bergerak terlalu cepat atau masalah teknis. Anda berakhir dengan posisi terbuka yang tidak terhedging.

## Simulasi Python: Naive vs. High-Fidelity

Mari kita simulasikan sebuah peluang arbitrase *Cross-Exchange* (Bursa A vs Bursa B).

```  python       
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

# Parameter Simulasi
n_events = 1000
spread_detected = 0.0020  # Peluang arbitrase 0.20% (20 bps)
trading_capital = 100000

# 1. NAIVE BACKTEST (Asumsi Sempurna)
# Tanpa biaya, tanpa latensi, tanpa slippage
profit_naive = np.full(n_events, spread_detected * trading_capital)

# 2. HIGH-FIDELITY SIMULATION (Realita)
maker_taker_fee = 0.0006  # 0.06% fee per sisi (Total 0.12%)
latency_slippage_penalty = 0.0005  # Penalti 0.05% karena harga bergerak sebelum eksekusi
execution_success_rate = 0.95  # 5% peluang terjadi "Broken Leg"

returns_hf = []
for _ in range(n_events):
    if np.random.random() < execution_success_rate:
        # Sukses eksekusi dua sisi
        net_spread = spread_detected - (maker_taker_fee * 2) - latency_slippage_penalty
        returns_hf.append(net_spread * trading_capital)
    else:
        # Broken Leg: Satu sisi gagal, terpaksa cut loss dengan penalti besar
        broken_leg_loss = -0.0050 * trading_capital # Rugi 0.5% karena harga berbalik
        returns_hf.append(broken_leg_loss)

# Kalkulasi Ekuitas
equity_naive = np.cumsum(profit_naive) + trading_capital
equity_hf = np.cumsum(returns_hf) + trading_capital

# Visualisasi
plt.figure(figsize=(12, 6))
plt.plot(equity_naive, label='Naive Backtest (Asumsi Sempurna)', color='green', linestyle='--')
plt.plot(equity_hf, label='High-Fidelity Simulation (Latensi + Fee + Risk)', color='red', linewidth=2)
plt.axhline(y=trading_capital, color='black', alpha=0.5)
plt.title('Arbitrase: Perbedaan Antara Teori dan Realitas Eksekusi')
plt.xlabel('Jumlah Peluang Arbitrase')
plt.ylabel('Total Modal (USD)')
plt.legend()
plt.grid(True, alpha=0.2)
plt.show()
```

**Analisis Hasil**

-   **Garis Hijau (Naive):** Menunjukkan pertumbuhan linier yang fantastis. Di dunia nyata, ini adalah "Laporan Penipuan" karena tidak memperhitungkan biaya hidup di pasar.

-   **Garis Merah (High-Fidelity):** Menunjukkan bahwa meskipun peluangnya ada, biaya transaksi dan risiko *Broken Leg* (penurunan tajam pada grafik) dapat membuat strategi ini sangat berisiko atau bahkan tidak menguntungkan.

## Strategi Validasi: Membangun "Confidence"

Untuk meningkatkan kualitas simulasi arbitrase Anda, terapkan langkah berikut:

1.  **Tick-by-Tick Playback:** Jangan gunakan bar data. Gunakan rekaman *Full Order Book* (L2 data) dan jalankan bot Anda seolah-olah sedang *live*.

2.  **Jitter Modeling:** Tambahkan variasi acak pada latensi (misal: kadang 10ms, kadang 200ms) untuk melihat seberapa sensitif strategi Anda terhadap performa jaringan.

3.  **Fee Sensitivity Analysis:** Uji apakah strategi Anda tetap untung jika bursa menaikkan biaya transaksi sebesar 0.01%. Jika tidak, strategi Anda terlalu rapuh.

## Kesimpulan: Survival of the Fastest

Dalam arbitrase, backtesting bukan untuk mencari parameter yang paling menguntungkan, melainkan untuk **mengukur ambang batas kegagalan**. Simulasi High-Fidelity memberi tahu Anda: *"Seberapa lambat bot saya boleh berjalan sebelum saya mulai merugi?"*

Jika hasil simulasi High-Fidelity Anda masih menunjukkan tren positif, barulah Anda layak mengeluarkan modal nyata untuk infrastruktur server yang lebih cepat.

## Daftar Pustaka

-   **Bouchaud, J. P.** (2018). *Trades, Quotes and Prices*. (Analisis mikrostruktur pasar).

-   **Hasbrouck, J.** (2007). *Empirical Market Microstructure*. (Fokus pada mekanisme harga dan biaya transaksi).
